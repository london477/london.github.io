<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Sipari≈ü Kontrol Paneli</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      padding: 20px;
    }
    h2 {
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #333;
      color: #fff;
    }
  </style>
</head>
<body>

<h2>üì¶ Sipari≈ü Kontrol Paneli</h2>

<table>
  <thead>
    <tr>
      <th>Tarih</th>
      <th>Platform</th>
      <th>Sipari≈ü No</th>
      <th>Tutar</th>
      <th>Durum</th>
    </tr>
  </thead>
  <tbody id="orders">
    <tr><td colspan="5">Y√ºkleniyor...</td></tr>
  </tbody>
</table>

<audio id="alarm">
  <source src="alarm.mp3" type="audio/mpeg">
</audio>

<script>
const sheetURL =
"https://docs.google.com/spreadsheets/d/1FLj8izC6-I4VXukH1OT-Y6Tntf_8g1U35lOJHYi1Lfs/gviz/tq?sheet=london477%20baskan%20index&tqx=out:json";

let oncekiSayi = 0;

async function yukle() {
  try {
    const res = await fetch(sheetURL);
    const text = await res.text();
    const json = JSON.parse(text.substring(47).slice(0, -2));
    const rows = json.table.rows;

    const tbody = document.getElementById("orders");
    tbody.innerHTML = "";

    const temiz = rows.filter(r => r.c && r.c[0]);

    temiz.forEach(r => {
      const tr = document.createElement("tr");
      r.c.forEach(c => {
        const td = document.createElement("td");
        td.textContent = c ? (c.f || c.v) : "";
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });

    if (temiz.length > oncekiSayi) {
      document.getElementById("alarm").play();
      oncekiSayi = temiz.length;
    }

  } catch (err) {
    document.getElementById("orders").innerHTML =
      "<tr><td colspan='5'>‚ùå Veri √ßekilemedi</td></tr>";
    console.error(err);
  }
}

yukle();
setInterval(yukle, 5000);
</script>

</body>
</html>
